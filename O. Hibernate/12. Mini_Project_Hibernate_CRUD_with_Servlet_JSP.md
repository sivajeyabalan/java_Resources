## 1. Topic Overview

Mini-project: CRUD on `Product` using Hibernate + Servlet + JSP. Demonstrates list, create, edit, delete with proper transactions and PRG.

## 2 . Topic definition

- **Scope**: Hibernate entity + DAO/service; servlets for list/save/delete; JSP views.

## 3. Deep Dive with Examples

Entity:
```java
@Entity @Table(name="product")
public class Product {
  @Id @GeneratedValue Long id;
  @Column(nullable=false) String name;
  BigDecimal price;
}
```

DAO/service (sketch):
```java
public class ProductService {
  private final SessionFactory sf;
  public ProductService(SessionFactory sf){this.sf=sf;}
  public List<Product> findAll(){ try(Session s=sf.openSession()){ return s.createQuery("from Product", Product.class).list(); } }
  public void save(Product p){ try(Session s=sf.openSession()){ var tx=s.beginTransaction(); s.merge(p); tx.commit(); } }
  public void delete(Long id){ try(Session s=sf.openSession()){ var tx=s.beginTransaction(); Product p=s.get(Product.class,id); if(p!=null) s.remove(p); tx.commit(); } }
}
```

Servlets:
```java
@WebServlet("/products")
public class ProductListServlet extends HttpServlet {
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    req.setAttribute("list", svc.findAll());
    req.getRequestDispatcher("/WEB-INF/views/products.jsp").forward(req, resp);
  }
}

@WebServlet("/products/save")
public class ProductSaveServlet extends HttpServlet {
  protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    Product p = new Product();
    if (req.getParameter("id") != null && !req.getParameter("id").isBlank()) p.setId(Long.valueOf(req.getParameter("id")));
    p.setName(req.getParameter("name"));
    p.setPrice(new BigDecimal(req.getParameter("price")));
    svc.save(p);
    resp.sendRedirect(req.getContextPath()+"/products");
  }
}

@WebServlet("/products/delete")
public class ProductDeleteServlet extends HttpServlet {
  protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    svc.delete(Long.valueOf(req.getParameter("id")));
    resp.sendRedirect(req.getContextPath()+"/products");
  }
}
```

JSP:
```jsp
<table>
<c:forEach var="p" items="${list}"><tr><td>${p.id}</td><td>${p.name}</td><td>${p.price}</td></tr></c:forEach>
</table>
<form method="post" action="${pageContext.request.contextPath}/products/save">
  <input name="name" placeholder="Name"/>
  <input name="price" placeholder="0.00"/>
  <button>Save</button>
</form>
```

## 4. Best Practices & Pitfalls

- Keep transactions around write operations; use PRG after POST.
- Validate inputs; handle optimistic locking for edits if needed.

## 5. Summary

- End-to-end CRUD stack with Hibernate managed persistence and Servlet/JSP UI.

## 6. Tricky Interview Questions

1) How would you introduce DTOs and validation without bloating servlets?
2) How to manage the SessionFactory lifecycle cleanly in a web app?

## 1. Topic Overview

Hibernate architecture centers around the `SessionFactory` (heavy, thread-safe) and `Session` (lightweight, per-unit-of-work). It integrates with JDBC, transactions, and caching.

## 2 . Topic definition

- **SessionFactory**: Immutable, built once per database, holds metadata and caches.
- **Session**: Wraps a JDBC connection; manages persistence context (first-level cache).
- **Transaction**: Demarcates a unit of work; commits/rolls back DB changes.
- **ServiceRegistry/Metadata**: Bootstrap components holding config and mapping info.

## 3. Deep Dive with Examples

```java
StandardServiceRegistry registry = new StandardServiceRegistryBuilder()
  .applySetting("hibernate.connection.url","jdbc:h2:mem:test;DB_CLOSE_DELAY=-1")
  .applySetting("hibernate.hbm2ddl.auto","update")
  .build();
Metadata metadata = new MetadataSources(registry).addAnnotatedClass(User.class).buildMetadata();
SessionFactory sf = metadata.buildSessionFactory();
try (Session s = sf.openSession()) {
  Transaction tx = s.beginTransaction();
  s.persist(new User());
  tx.commit();
}
```

## 4. Best Practices & Pitfalls

- Create one `SessionFactory` per DB and reuse; it is expensive to build.
- Open/close `Session` per request/use-case; do not share across threads.
- Pitfall: Operating outside a transaction leads to auto-commit anomalies.

## 5. Summary

- `SessionFactory` is the heavyweight singleton; `Session` is per unit-of-work with first-level cache.

## 6. Tricky Interview Questions

1) What lives in the first-level cache and when is it cleared?
2) Why is `SessionFactory` thread-safe but `Session` is not?

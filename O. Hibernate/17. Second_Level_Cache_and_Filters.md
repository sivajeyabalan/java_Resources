## 1. Topic Overview

- Hibernate second-level cache accelerates entity loads; filters/soft deletes control row visibility without physical deletion.

## 2 . Topic definition

- WHAT: 2nd-level cache (entities/collections) and query cache; providers (EHCache, Infinispan); `@Where`, `@Filter` for soft deletes/tenancy.
- WHY: Reduce DB load and latency; implement cross-cutting data visibility.
- HOW: Configure cache provider, mark cacheable entities; enable query cache judiciously; define filters and enable per session.

## 3. Deep Dive with Examples

```properties
# application.properties (example)
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.use_query_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.cache.jcache.config=classpath:ehcache.xml
```

```java
import org.hibernate.annotations.Cache; import org.hibernate.annotations.CacheConcurrencyStrategy;
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
@jakarta.persistence.Entity
class Product { @jakarta.persistence.Id Long id; String name; }
```

```java
// Soft delete with @Where
@jakarta.persistence.Entity
@org.hibernate.annotations.Where(clause = "deleted = false")
class Customer { @jakarta.persistence.Id Long id; boolean deleted; }
```

```java
// Filter example
@org.hibernate.annotations.FilterDef(name = "tenant", parameters = @org.hibernate.annotations.ParamDef(name = "tid", type = Long.class))
@org.hibernate.annotations.Filter(name = "tenant", condition = "tenant_id = :tid")
class Invoice { @jakarta.persistence.Id Long id; Long tenant_id; }
// Enable per session: session.enableFilter("tenant").setParameter("tid", 10L);
```

## 4. Best Practices & Pitfalls

- Cache only stable, frequently-read entities; beware stale data.
- Query cache is fragile; cache miss invalidations carefully.
- Filters/Where apply to all queries; ensure admin paths bypass when needed.

## 5. Summary

- Use 2nd-level cache selectively; filters/soft deletes provide flexible row-level visibility.

## 6. Tricky Interview Questions

1. When does the query cache help vs hurt performance?
2. Differences between `@Where` and `@Filter` in control and flexibility.


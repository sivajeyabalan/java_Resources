## 1. Topic Overview

- Efficient APIs return only needed data and page results. Use projections and DTO mapping to avoid loading entire entities.

## 2 . Topic definition

- WHAT: `setFirstResult`/`setMaxResults`, `Pageable` in Spring Data, JPA constructor expressions, interface-based projections, `Tuple`/`Record` mappings.
- WHY: Reduce payload and memory; speed up queries.
- HOW: Use JPQL constructor projections or Spring Data projections; paginate queries and sort reliably.
- WHEN/WHERE: List endpoints, search results, dashboards.
- WHAT IF: Fetch joins with pagination can be invalid or slow; prefer subqueries or two-step fetch.

## 3. Deep Dive with Examples

```java
// JPA constructor expression
record BookView(Long id, String title, String authorName) {}
List<BookView> views = em.createQuery(
  "select new BookView(b.id, b.title, a.name) from Book b join b.author a order by b.id",
  BookView.class)
  .setFirstResult(0)
  .setMaxResults(20)
  .getResultList();
```

```java
// Spring Data interface projection
interface BookProjection { Long getId(); String getTitle(); String getAuthorName(); }
interface BookRepo extends org.springframework.data.jpa.repository.JpaRepository<Book, Long> {
  @org.springframework.data.jpa.repository.Query("select b.id as id, b.title as title, a.name as authorName from Book b join b.author a")
  org.springframework.data.domain.Page<BookProjection> findViews(org.springframework.data.domain.Pageable p);
}
```

Pagination cautions:
- Avoid `join fetch` with `Pageable` on multi-valued collections; use two queries or distinct root pagination.
- Provide stable sort keys (e.g., by id) to avoid duplicates/missing items between pages.

## 4. Best Practices & Pitfalls

- Return DTOs to decouple API from entities.
- For large lists, stream results or use cursor-based pagination where applicable.
- Beware n+1 in DTO queries; join necessary relations explicitly.

## 5. Summary

- Use projections and careful pagination to deliver fast, lean responses.

## 6. Tricky Interview Questions

1. Why does `join fetch` break `Pageable` in many JPA providers?
2. Show two-query pattern to page roots and fetch children efficiently.


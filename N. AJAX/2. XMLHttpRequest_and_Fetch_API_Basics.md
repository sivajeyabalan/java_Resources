## 1. Topic Overview

Two primary browser APIs for AJAX are `XMLHttpRequest` (XHR) and the modern `fetch()` API. Both send HTTP requests and handle responses asynchronously.

## 2 . Topic definition

- **XMLHttpRequest**: Event/callback-based; mature and widely supported.
- **Fetch API**: Promise-based; simpler syntax; supports streaming and Request/Response objects.

## 3. Deep Dive with Examples

XMLHttpRequest:
```html
<script>
  function loadData() {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', '/api/time');
    xhr.timeout = 5000;
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          document.body.innerText = xhr.responseText;
        } else {
          alert('Error: ' + xhr.status);
        }
      }
    };
    xhr.ontimeout = () => alert('Timeout');
    xhr.send();
  }
</script>
<button onclick="loadData()">Load</button>
```

Fetch:
```html
<script>
async function send() {
  try {
    const res = await fetch('/api/echo', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ msg: 'hello' })
    });
    if (!res.ok) throw new Error(res.status);
    const data = await res.json();
    console.log(data);
  } catch (e) { console.error(e); }
}
</script>
<button onclick="send()">Send</button>
```

Servlet endpoints:
```java
@WebServlet("/api/time")
public class TimeApi extends HttpServlet {
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    resp.setContentType("text/plain;charset=UTF-8");
    resp.getWriter().write(java.time.Instant.now().toString());
  }
}

@WebServlet("/api/echo")
public class EchoApi extends HttpServlet {
  protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String json = new String(req.getInputStream().readAllBytes(), java.nio.charset.StandardCharsets.UTF_8);
    resp.setContentType("application/json");
    resp.getWriter().write(json);
  }
}
```

## 4. Best Practices & Pitfalls

- Handle network errors and timeouts; parse JSON safely.
- Prefer `fetch` for simplicity; use XHR when you need old-browser features or progress events.

## 5. Summary

- XHR is callback-based; fetch is promise-based; both handle async HTTP from the browser.

## 6. Tricky Interview Questions

1) When would you prefer XHR over fetch and why?
2) How do you cancel an in-flight fetch request?

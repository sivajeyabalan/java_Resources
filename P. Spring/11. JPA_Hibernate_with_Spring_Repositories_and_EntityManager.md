## 1. Topic Overview

Spring integrates with JPA (Hibernate as provider) to manage `EntityManager`, transactions, and repositories, enabling concise data access.

## 2 . Topic definition

- **EntityManager**: JPA interface for persistence context operations.
- **Spring Data JPA**: Repository abstraction reducing boilerplate (`CrudRepository`, `JpaRepository`).
- **Configuration**: `LocalContainerEntityManagerFactoryBean`, `JpaTransactionManager`.

## 3. Deep Dive with Examples

Config:
```java
@Configuration
@EnableJpaRepositories(basePackages = "com.example.repo")
class JpaCfg {
  @Bean DataSource ds(){ return new org.h2.jdbcx.JdbcDataSource(); }
  @Bean LocalContainerEntityManagerFactoryBean emf(DataSource ds){
    var f = new LocalContainerEntityManagerFactoryBean();
    f.setDataSource(ds);
    f.setPackagesToScan("com.example.domain");
    f.setJpaVendorAdapter(new HibernateJpaVendorAdapter());
    f.getJpaPropertyMap().put("hibernate.hbm2ddl.auto", "update");
    return f;
  }
  @Bean PlatformTransactionManager tx(EntityManagerFactory emf){ return new JpaTransactionManager(emf); }
}
```

Entity and repository:
```java
@Entity class Product { @Id @GeneratedValue Long id; String name; BigDecimal price; }
public interface ProductRepo extends JpaRepository<Product, Long> {
  List<Product> findByNameStartingWith(String prefix);
}
```

Service:
```java
@Service
class ProductService { private final ProductRepo repo; ProductService(ProductRepo r){ this.repo=r; }
  @Transactional public Product save(Product p){ return repo.save(p); }
}
```

## 4. Best Practices & Pitfalls

- Keep repository interfaces focused; move business logic to services.
- Tune fetch strategies and DTO projections to avoid N+1.
- Pitfall: Mixing EntityManager manual operations with Spring Data repositories unexpectedly.

## 5. Summary

- Spring + JPA streamlines persistence with repositories and managed transactions.

## 6. Tricky Interview Questions

1) How do derived query methods map to JPQL under the hood?
2) When to use `@EntityGraph` or projections to optimize queries?

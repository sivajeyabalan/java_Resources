## 1. Topic Overview

File upload uses multipart/form-data parsing; download streams bytes with proper headers. Jakarta Servlet provides `@MultipartConfig` and `Part` API.

## 2 . Topic definition

- **Multipart**: Request encoded as parts; each `Part` may be a file or field.
- **Content-Disposition**: Contains filename for uploaded files.
- **Streaming**: Use buffered streams; set `Content-Type` and `Content-Disposition` for downloads.

## 3. Deep Dive with Examples

```java
@WebServlet("/upload")
@MultipartConfig(maxFileSize = 5_000_000)
public class UploadServlet extends HttpServlet {
  @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException, ServletException {
    Part file = req.getPart("file");
    String name = java.nio.file.Paths.get(file.getSubmittedFileName()).getFileName().toString();
    java.nio.file.Path target = java.nio.file.Paths.get(getServletContext().getRealPath("/uploads/"), name);
    try (var in = file.getInputStream()) { java.nio.file.Files.copy(in, target, java.nio.file.StandardCopyOption.REPLACE_EXISTING); }
    resp.sendRedirect(req.getContextPath()+"/upload?ok=1");
  }
}
```

```java
@WebServlet("/download")
public class DownloadServlet extends HttpServlet {
  @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String name = req.getParameter("name");
    java.nio.file.Path file = java.nio.file.Paths.get(getServletContext().getRealPath("/uploads/"), name);
    resp.setContentType(getServletContext().getMimeType(name));
    resp.setHeader("Content-Disposition", "attachment; filename=\""+name+"\"");
    java.nio.file.Files.copy(file, resp.getOutputStream());
  }
}
```

## 4. Best Practices & Pitfalls

- Validate filename, type, and size; store outside webroot when possible.
- Generate unique names to avoid collisions; scan for malware if required.
- Stream large files; avoid loading entire files into memory.

## 5. Summary

- Use `@MultipartConfig` for uploads; set headers for downloads; stream efficiently.

## 6. Tricky Interview Questions

1) How to prevent path traversal in download URLs?
2) How to support resumable downloads and range requests?

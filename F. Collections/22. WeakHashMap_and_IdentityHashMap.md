## 1. Topic Overview

- Special-purpose maps: `WeakHashMap` for GC-sensitive caches and `IdentityHashMap` for reference-identity keys.

## 2 . Topic definition

- WHAT: `WeakHashMap` keys are weakly referenced; entries may disappear after GC. `IdentityHashMap` uses `==` for key equality, not `equals`.
- WHY: Avoid memory leaks with caches; model identity semantics distinct from logical equality.
- HOW: Use strong references elsewhere to keep keys alive in `WeakHashMap`; know iteration may skip removed entries.
- WHEN/WHERE: Metadata caches; frameworks tracking objects without preventing GC; graph algorithms with identity semantics.
- WHAT IF: Using mutable keys or misunderstanding GC behavior leads to surprising disappearance; `IdentityHashMap` breaks when logical equality is needed.

## 3. Deep Dive with Examples

```java
import java.util.*;

class WeakDemo {
    public static void main(String[] args) throws Exception {
        Map<Object, String> map = new WeakHashMap<>();
        Object k = new Object();
        map.put(k, "value");
        k = null; // eligible for GC => entry may vanish
        System.gc();
        Thread.sleep(100);
        System.out.println(map.size()); // possibly 0
    }
}
```

```java
// Identity semantics
import java.util.*;

class IdentityDemo {
    public static void main(String[] args) {
        Map<String, Integer> idMap = new IdentityHashMap<>();
        idMap.put(new String("a"), 1);
        idMap.put(new String("a"), 2); // distinct keys by reference
        System.out.println(idMap.size()); // 2
    }
}
```

## 4. Best Practices & Pitfalls

- For caches, consider `LinkedHashMap` LRU or Caffeine instead; `WeakHashMap` is not a general cache.
- Never rely on timely GC; entries may linger or disappear unexpectedly.
- Avoid `IdentityHashMap` in public APIs; document semantics clearly.

## 5. Summary

- Use these specialized maps judiciously with full understanding of GC and identity semantics.

## 6. Tricky Interview Questions

1. Why is `WeakHashMap` not a reliable cache? Alternatives?
2. Demonstrate how `IdentityHashMap` can store duplicate logical keys.


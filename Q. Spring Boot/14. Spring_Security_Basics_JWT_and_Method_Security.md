## 1. Topic Overview

- Secure Spring Boot apps with HTTP security, JWT-based authentication, and method-level authorization.

## 2 . Topic definition

- WHAT: Spring Security config (HttpSecurity), authentication/authorization, filter chain, JWT, method security (`@PreAuthorize`).
- WHY: Protect endpoints and data; implement stateless APIs.
- HOW: Configure security filter chain, issue/validate JWTs, secure endpoints by role/scope.
- WHEN/WHERE: Any exposed API; stateless microservices.
- WHAT IF: Misconfigured matchers expose endpoints; storing secrets insecurely compromises tokens.

## 3. Deep Dive with Examples

```java
// Security configuration
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableMethodSecurity
class SecurityConfig {
    @Bean SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(reg -> reg
                .requestMatchers("/actuator/health").permitAll()
                .anyRequest().authenticated())
            .oauth2ResourceServer(oauth2 -> oauth2.jwt());
        return http.build();
    }
}
```

```java
// Method security
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

@RestController
class OrderController {
    @PreAuthorize("hasAuthority('SCOPE_orders.write')")
    @PostMapping("/orders")
    public String create() { return "ok"; }
}
```

JWT strategies:
- Use an auth server (Keycloak/Okta) or issue signed JWTs; validate via jwk-set or shared secret.
- Keep tokens short-lived; use refresh tokens where applicable.

## 4. Best Practices & Pitfalls

- Principle of least privilege; use scopes/roles consistently.
- Secure Actuator; expose only non-sensitive endpoints publicly.
- Store secrets in environment or vault; never commit keys.

## 5. Summary

- Spring Security with JWT enables stateless secure APIs and fine-grained method authorization.

## 6. Tricky Interview Questions

1. Differences between session-based and JWT-based auth in Spring Boot.
2. How do you validate JWTs and rotate keys safely?

